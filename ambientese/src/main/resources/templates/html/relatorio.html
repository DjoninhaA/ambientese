<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatorio</title>
    <style>
      body {
        margin: 0;
        padding-right: 0;
        background-color: #e7e5e4;
      }

     /* ESTILO NAVBAR */
      .navbar {
        display: flex;
        align-items: center;
        justify-content: normal;
        background-color: #0077C8;
        padding: 10px;
        height: 100%;
        color: white;
        z-index: 2; /* Define uma pilha de ordem para garantir que a navbar fique acima de outros elementos */
        top: 0;
        position: sticky;
    }

    .menu-btn {
        font-size: 30px;
        cursor: pointer;
        color: white;
        margin-right: 20px;
    }

    .return{
      cursor: pointer;
    }
    .return img {
        height: 25px;
    }

    .side-menu {
        height: 95%;
        width: 0;
        position: fixed;
        top: 55px; /* Alinhar abaixo da navbar */
        left: 0;
        background-color: #0077C8;
        overflow-x: hidden;
        transition: 0.3s;
        white-space: nowrap;
        z-index: 3; /* Define uma pilha de ordem para garantir que a aba lateral fique acima de outros elementos */
    }

    .side-menu a {
        padding: 15px 20px;
        text-decoration: none;
        font-size: 18px;
        color: #ffffff;
        display: block;
        transition: 0.3s;
        margin: 10px 10px;
        border-radius: 5px;
    }

    .side-menu a i {
    margin-right: 10px; 
    vertical-align: middle;
    }

    .side-menu a:hover {
        background-color: #487DF7;
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.26);
    }

    .logout-btn {
        position: absolute;
        bottom: 20px;
        left: 20px;
        right: 20px;
        padding: 15px 20px;
        text-align: center;
        background-color: #2864F6;
        color: white;
        border-radius: 5px;
        transition: background-color 0.3s;
    }

    /* FIM DO ESTILO NAVBAR */

    .main{
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }


       .tudo {
        display: flex;
        width: 60%;
        height: 60%;
        justify-content: center;
        border: 2px solid gray;
        border-radius: 20px;
        background-color: #FFFFFF;
       } 

       .coluna1 {
        display: flex;
        flex-direction: column;
        width: 25vh;
        height: 45vh;
        padding: 20px;
        margin-top: 60px;
        gap: 15px;
        overflow: hidden;
        flex: none;
        align-items: stretch; /* Ajustar flexbox */
        margin-right: -20px;
      }

      .coluna1 div {
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .text {
        margin-top: 0;
        display: flex;
        flex-direction: column;
      }
      .text h3{
        margin: 0;
      }

      .coluna1 p {
        max-lines: 3;
        overflow: hidden;
        text-overflow: ellipsis;
        margin: 0; /* Remover margens do texto */
      }

       .coluna2 {
        width: 50vh;
        height: 45vh;
        display: flex;
        flex-direction: column;
        padding: 20px;
        margin-top: 60px;
        gap: 15px;
       }


       .comp1, .comp2 {
        border: 2px solid gray;
        height: 50%;
        border-radius: 20px;
        flex: 1; /* Faz com que os componentes ocupem todo o espaço verticalmente */
        display: flex;
        justify-content: center;
        align-items: center;
       }

       /*graficos*/
       .porcentagem {
        display: flex;
        justify-content: space-between;
        align-items: center;        
       }


       .graphs p {        
        align-items: center;
        text-align: center;
        align-items: center;
        border-radius: 50%;
       }

       /*chat*/
       .container {
        max-width: 600px;
        width: 100%;
        padding: 20px;
        margin-left: -10px;
        border-radius: 5px;
        background-color: #fff;
        text-align: center;
    }
    
        #progressContainer {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 25px;
            margin: 20px 0;
        }
        
        #progressBar {
          height: 25px;
          width: 0;
          background-color: #4caf50;
          border-radius: 25px;
          transition: width 0.5s;
          display: flex;
          align-items: center;
          justify-content: center;
          text-align: center;
          color: white;
          font-weight: bold;
        }
        


       .logoEmpresa{
        height: 100px;
        object-fit: contain;
        width: 100px;

       }


       /*selo*/

       .logoSelo{
        align-items: center;
        justify-content: center;
        display: flex;
        width: 250px;
        height: 40px
       }

       .logoSelo img {
        position: relative;
        top: 15px;

       }

       .textoSelo h2{
        font-size: 30px;
        text-align: center;
       }
       .textoSelo p{
        font-size: 25px;
        text-align: center;
        margin-top: -20px;
       }

       .buttons {
        align-items: center;
        justify-content: space-around;
        display: flex;
        padding-bottom: 10px
       }

       .btn {
        cursor: pointer;
        background-color: #FFFFFF;
       }

       .btn img{
        margin-bottom: -5px;
       }


    </style>
</head>
<body>
  <!-- NAVBAR -->
    
  <div class="navbar">
    <div class="menu-btn" onclick="toggleMenu()">
        &#9776; <!-- Ícone de menu (três linhas horizontais) -->
    </div>
    <div class="return">
      <a href="/home">
        <img src="../../static/images/ambientetext.svg" alt="Logo da Empresa">
      </a>
    </div>
  </div>

  <div id="sideMenu" class="side-menu">
    <a href="/listarEmpresa"><i class="fa-solid fa-building"></i>Empresas</a>
    <a href="/listarFuncionario"><i class="fa-solid fa-user"></i>Funcionários</a>
    <a href="/ranking"><i class="fa-solid fa-ranking-star"></i>Ranking</a>
    <a href="/auth" class="logout-btn"><i class="fa-solid fa-right-from-bracket"></i>Sair</a>
  </div>
    <div class="main">
      <div class="tudo">
        <div class="coluna1">
          <div class="comp1">
            <span class="logo">
              <div>
                <img id="logoEmp"  class="logoEmpresa" src=""  alt="imagem Empresa">
              </div>
              <div class="text">
                <h3><span id="nomeEmpresa">Nome da Empresa</span></h3>
                <p><span id="ramoEmpresa">Ramo</span></p>
                <p><span id="porteEmpresa">Porte</span></p>
              </div>
            </span>
          </div>
          <div class="comp1">
            <span class="ranking">
              <div>
                <img src="../../static/images/trofeu.svg" alt="">
              </div>
              <div class="text">
                <h3>Ranking Geral <span id="rankingGeral">(Data)</span></h3>
                <p>No mesmo ramo <span id="rankingRamo">(Data)</span></p>
                <p>No mesmo porte <span id="rankingPorte">(Data)</span></p>
              </div>
            </span>
          </div>
        </div>
        <div class="coluna2">
          <div class="comp2">
            <span class="porcentagem">
              <div class="graphs">
                <div class="container">
                  <div id="resultContainer" style="display: none;">
                      <h2>Resultado</h2>
                      <div id="progressContainer">
                          <div id="progressBar"><span id="progressText"></span></div>
                      </div>
                      <p id="scoreText"></p>
                  </div>
              </div>
            </div>
            </span>
          </div>
          <div class="comp2">
            <span class="selo">
              <div class="logoSelo">
                <img src="../../static/images/selo.svg" alt="">
              </div>
              <div class="textoSelo">
                <h2>Selo Aprovado!</h2>
                <p>Amigo do Meio Ambiente</p>
              </div> 
              <div class="buttons">
                <button class="btn" onclick="generateCertificate()">
                    <img src="../../static/images/download.svg" alt="Exportar"
                    >Exportar</button>
              </div>
            </span>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
      function toggleMenu() {
        var menu = document.getElementById("sideMenu");
        if (menu.style.width === "250px") {
            menu.style.width = "0";
        } else {
            menu.style.width = "250px";
        }
    }

      function updateProgressBar(score, totalQuestions) {
        const percentage = (score / totalQuestions) * 100;
    
        document.getElementById('resultContainer').style.display = 'block';
        document.getElementById('progressBar').style.width = `${percentage}%`;
        document.getElementById('progressText').innerText = `${percentage.toFixed(1)}%`;
        document.getElementById('scoreText').innerText = `Sua Empresa Está Conforme em ${score} dos ${totalQuestions} tópicos.`;
      }
    
      document.addEventListener("DOMContentLoaded", function() {
       
        // Função para carregar os dados da empresa via AJAX
        function buscarDados() {
          fetch(API)
              .then(response => {
                  if (!response.ok) {
                      throw new Error('Erro ao obter os dados da API');
                  }
                  return response.json();
              })
              .then(data => {
                  // Atualiza os elementos na tela com os dados recebidos
                  document.getElementById('logoEmp').src = data.logo;
                  document.getElementById('nomeEmpresa').textContent = data.nomeFantasia;
                  document.getElementById('ramoEmpresa').textContent = data.ramo;
                  document.getElementById('porteEmpresa').textContent = data.porte;
                  console.log(data)
              })
              .catch(error => {
                  console.error('Erro ao buscar dados:', error);
              });
      }
  
      // Chamar a função para buscar os dados quando a página carregar
      buscarDados();
  });


        //SEGUNDO FETCH PARA OS DADOS DO RANKING
        //function buscarDadosRanking() {

        //fetch(`/teste/${idEmpresa}`)
          //  .then(response => {
            //    if (!response.ok) {
              //      throw new Error('Erro ao buscar os dados da empresa');
               // }
                //return response.json();
           // })
            //.then(data => {
             //   document.getElementById('rankingGeral').textContent = data.rankingGeral;
               // document.getElementById('rankingRamo').textContent = data.rankingRamo;
                //document.getElementById('rankingPorte').textContent = data.rankingPorte;
                //console.log('Dados do Ranking:', data);
                // Aqui você pode atualizar sua interface com os dados recebidos
            //})
            //.catch(error => {
             //   console.error('Erro na requisição:', error);
            //});
        //}

        //buscarDadosRanking();


      
        // Extrair empresaId da URL (Exemplo: /relatorio/123)
        function getIdFromUrl() {
          const pathname = window.location.pathname;
          const parts = pathname.split('/');
          const id = parts[2];
          return id;
      }
      
          const idEmpresa = getIdFromUrl();
          console.log("ID do Empresa:", idEmpresa);

          const API = `http://localhost:8080/busca/${idEmpresa}`;
      
        // Chama a função para carregar os dados da empresa ao carregar a página
        if (empresaId) {
          carregarDadosEmpresa(empresaId);
        } else {
          console.error('ID da empresa não encontrado na URL.');
          // Aqui você pode tratar o caso em que o ID da empresa não é fornecido na URL
        }
           


      function generateCertificate() {
        const { jsPDF } = window.jspdf;
    
        // Criar um documento jsPDF em formato paisagem
        const doc = new jsPDF({
          orientation: 'landscape'
        });
    
        const companyName = "Nome Empresa"; // Você pode obter isso dinamicamente
        const percentage = (score / totalQuestions) * 100;
    
        doc.setFontSize(22);
        doc.text('Certificado de Conformidade', 20, 30);
    
        doc.setFontSize(16);
        doc.text(`Certificamos que a empresa ${companyName} está conforme em`, 20, 50);
        doc.text(`${score} dos ${totalQuestions} tópicos avaliados.`, 20, 60);
        doc.text(`Isso representa uma conformidade de ${percentage.toFixed(2)}%.`, 20, 70);
    
        doc.setFontSize(12);
        doc.text('Parabéns pela conquista do selo "Amigo do Meio Ambiente"!', 20, 90);
    
        // Opcional: adicionar logo
        doc.addImage('data.logo', 'PNG', 20, 100, 50, 50);
    
        doc.save('certificado.pdf');
      }
    </script>
</body>
</html>
